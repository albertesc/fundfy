---
import image from "../assets/fundfy_logo.svg";
import Button from "./atoms/Button.astro";
import Link from "./atoms/Link.astro";
---

<header class="fixed top-0 bottom-none z-10 w-full">
  <div
    class="opacity-0 background-blur absolute inset-0 bg-white/30 backdrop-blur-md transition-opacity duration-300 pointer-events-none"
  >
  </div>
  <div
    class="max-w-[1160px] mx-auto flex align-center justify-between px-4 py-6"
  >
    <a class="logo inline-block w-40 lg:w-52 z-10 cursor-pointer" data-time="0">
      <img src={image.src} alt="Logo" class="w-full h-full" />
    </a>

    <div class="w-full justify-end items-center gap-[16px] lg:gap-[52px] flex">
      <nav
        id="nav-menu"
        role="navigation"
        aria-label="Menú principal"
        class="hidden md:flex absolute px-3 pb-4 pt-7 md:p-0 top-0 left-0 w-full md:w-auto bg-primary shadow-md md:shadow-none md:relative md:bg-transparent rounded-bl-xl rounded-br-xl md:rounded-none z-20"
      >
        <div class="justify-end mb-4 flex md:hidden">
          <span class="sr-only">Cerrar menú</span>
          <button
            id="close-menu-btn"
            class="text-dark absolute top-6 right-4"
            aria-label="Cerrar menú"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              class="size-8"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M6 18 18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <ul
          class="menu-list flex gap-[8px] md:gap-[32px] lg:gap-[52px] flex-col md:flex-row text-dark md:text-white text-center md:text-left"
        >
          <li>
            <Link dataTime="80" className="animated-link font-semibold"
              >Inversión</Link
            >
          </li>
          <li>
            <Link dataTime="225" className="animated-link font-semibold"
              >Experiencias</Link
            >
          </li>
          <li>
            <Link className="animated-link font-semibold" dataTime="435"
              >FAQs</Link
            >
          </li>
          <li>
            <Link className="animated-link font-semibold" dataTime="480"
              >Hazte socio</Link
            >
          </li>
        </ul>
      </nav>
      <Button href="#" tag="a">
        Lanzar App
        <span class="block ml-2 group-hover:translate-x-1 transition-transform"
          >➔</span
        >
      </Button>

      <div class="md:hidden z-10">
        <button
          type="button"
          id="hamburger-btn"
          class="flex items-center text-gray-500"
          aria-controls="navbar-default"
          aria-expanded="false"
        >
          <span class="sr-only">Abrir menú</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="currentColor"
            class="size-8"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>
</header>

<script>
  const section = document.querySelector(".observe");
  const blur = document.querySelector(".background-blur");
  const menuList = document.querySelector(".menu-list");

  function comprobarScroll() {
    if (!section) return;
    const rect = section.getBoundingClientRect();

    if (!blur || !menuList) return;

    const offset = 100;

    if (rect.top <= offset) {
      blur.classList.add("opacity-100");
      menuList.classList.add("md:text-dark");
      menuList.classList.remove("md:text-white");
    } else {
      blur.classList.remove("opacity-100");
      menuList.classList.remove("md:text-dark");
      menuList.classList.add("md:text-white");
    }
  }

  window.addEventListener("scroll", comprobarScroll);
  window.addEventListener("resize", comprobarScroll);
  document.addEventListener("DOMContentLoaded", comprobarScroll);
</script>

<script>
  import { gsap } from "gsap";

  document.addEventListener("DOMContentLoaded", function () {
    const menu = document.getElementById("nav-menu");
    const menuButton = document.getElementById("hamburger-btn");
    const closeButton = document.getElementById("close-menu-btn");

    let isOpen = false;

    if (menuButton === null || closeButton === null) {
      return;
    }

    function openMenu() {
      gsap.fromTo(
        menu,
        {
          scaleY: 0,
          opacity: 0,
          transformOrigin: "top center",
          display: "block",
        },
        {
          scaleY: 1,
          opacity: 1,
          duration: 0.6,
          ease: "elastic.out(1, 0.75)",
        }
      );
      isOpen = true;
    }

    function closeMenu() {
      gsap.to(menu, {
        scaleY: 0,
        opacity: 0,
        duration: 0.4,
        ease: "power2.inOut",
        onComplete: () => {
          if (menu) {
            menu.style.display = "none";
          }
        },
      });
      isOpen = false;
    }

    menuButton.addEventListener("click", () => {
      if (!isOpen) {
        openMenu();
      }
    });

    closeButton.addEventListener("click", closeMenu);
  });
</script>
